angular.module("appDashboard",["ngResource","ui.router"]),angular.module("appDashboard").run(["$rootScope","$timeout","$interval","$state","ServantAngularService","Application",function(e,n,t,r,a,s){e.s={},e.$on("$stateChangeError",function(n,t,a,s,o,i){switch(e.s.loading=!1,i){case"no_subscription":return r.go("plan",a);case"no_number":return r.go("number",a);default:return r.go("servants")}}),e.s.initializeServantSDK=function(n){var t={application_client_id:"none",token:e.s.user.servant_access_token_limited,protocol:window.location.host.indexOf("localhost")>-1?"http":"https",image_dropzone_class:"image-dropzone"};Servant.initialize(t,function(){return n()})},e.s.loadUserAndServants=function(n){s.loadUserAndServants(null,function(t){return e.s.user=t.user,e.s.servants=t.servants,e.s.user.missing_servants=t.missing_servants,n(null,t)},function(e){return 401===e.status?(window.location="/",!1):n(e,null)})},e.s.setServant=function(n,t){for(i=0;i<e.s.servants.length;i++)e.s.servants[i]._id.toString()===n&&(e.servant_index=i);return a.setServant(e.s.servants[e.servant_index]._id),t()},e.s.showModal=function(n){document.getElementById("modal-overlay").style.display="block",document.getElementById("modal-box").style.display="block",e.view=n},e.s.hideModal=function(){document.getElementById("modal-overlay").style.display="none",document.getElementById("modal-box").style.display="none",e.view="dashboard"}}]),angular.module("appDashboard").config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("servants",{url:"/",templateUrl:"views/dashboard/servants.html",resolve:{initializeView:initializeView}}).state("plan",{url:"/:servantID/plan",templateUrl:"views/dashboard/plan.html",resolve:{initializeView:initializeView}}).state("menu",{url:"/:servantID/menu",templateUrl:"views/dashboard/menu.html",resolve:{initializeView:initializeView}})}]);var initializeView=["$q","$rootScope","$state","$stateParams","Application","ServantAngularService",function(e,n,t,r){var a=e.defer();return n.s.user&&n.s.servants.length?n.s.user&&r.servantID?n.s.setServant(r.servantID,function(){return n.s.loading=!1,a.resolve()}):!0:(n.s.loading=!0,n.s.loadUserAndServants(function(){console.log("User and Servant Data Loaded: ",n.s.user),n.s.initializeServantSDK(function(){return n.s.loading=!1,r.servantID?n.s.setServant(r.servantID,function(){return n.s.loading=!1,a.resolve()}):a.resolve()})}),a.promise)}];angular.module("appDashboard").config(["$locationProvider",function(e){e.hashPrefix("!")}]),angular.module("appDashboard").controller("DashboardController",["$rootScope","$scope","$timeout","$state","Application","ServantAngularService",function(e,n){n.showModal=function(n){document.getElementById("modal-overlay").style.display="block",document.getElementById("modal-box").style.display="block",e.view=n},n.hideModal=function(){document.getElementById("modal-overlay").style.display="none",document.getElementById("modal-box").style.display="none",e.view="dashboard"}}]),angular.module("appDashboard").controller("PlanController",["$rootScope","$scope","$timeout","$state","$stateParams","$location","Application","ServantAngularService",function(e,n,t,r,a,s,o,i){n.newPlan="plan1",e.s.servants[e.servant_index].servant_pay.subscription_plan_id&&(n.newPlan=e.s.servants[e.servant_index].servant_pay.subscription_plan_id),n.plans=[{label:"Plan 1 for $12/Month",plan_id:"plan1"},{label:"Plan 2 for $24/Month",plan_id:"plan2"},{label:"Plan 3 for $36/Month",plan_id:"plan3"},{label:"Plan 4 for $48/Month",plan_id:"plan4"},{label:"Plan 5 for $60/Month",plan_id:"plan5"}],n.initialize=function(){},n.subscribe=function(){if(n.subscribing=!0,"active"===e.s.servants[e.servant_index].servant_pay.subscription_status){if(n.newPlan===e.s.servants[e.servant_index].servant_pay.subscription_plan_id)return!1;i.servantpaySubscriptionUpdate(n.newPlan).then(function(){e.s.loadUserAndServants(function(){n.subscribing=!1,n.subscribed=!0,t(function(){n.subscribed=!1},2e3)})},function(e){n.subscribing=!1,n.error=e.message,console.log(e)})}else i.servantpaySubscriptionCreate(n.newPlan).then(function(){e.s.loadUserAndServants(function(){n.subscribing=!1,n.subscribed=!0,t(function(){n.subscribed=!1},2e3)})},function(e){n.subscribing=!1,n.error=e.message,console.log(e)})},n.cancelPlan=function(){n.canceling=!0,i.servantpaySubscriptionCancel().then(function(t){console.log(t),e.s.loadUserAndServants(function(){n.canceling=!1})},function(e){n.canceling=!1,n.error=e.message,console.log(e)})}}]),angular.module("appDashboard").factory("Application",["$resource",function(e){return e("",null,{loadUserAndServants:{method:"GET",isArray:!1,url:"/user_and_servants"}})}]),angular.module("appDashboard").service("ServantAngularService",["$rootScope","$q",function(e,n){this.status=function(){return Servant.status},this.connect=function(){Servant.connect()},this.getUserAndServants=function(){var e=n.defer();return Servant.getUserAndServants(function(n){e.resolve(n)},function(n){e.reject(n)}),e.promise},this.showServant=function(e){var t=n.defer();return Servant.showServant(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},this.setServant=function(e){var t=n.defer();return Servant.setServant(e),t.resolve(),t.promise},this.initializeUploadableArchetypes=function(e){var t=n.defer();return Servant.initializeUploadableArchetypes(e),t.resolve(),t.promise},this.instantiate=function(e){var t=n.defer();return Servant.instantiate(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},this.validate=function(e,t){var r=n.defer();return Servant.validate(e,t,function(e,n){e&&r.resolve(e),n&&r.resolve(n)},function(e){r.reject(e)}),r.promise},this.saveArchetype=function(e,t){var r=n.defer();return Servant.saveArchetype(e,t,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.showArchetype=function(e,t){var r=n.defer();return Servant.showArchetype(e,t,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.queryArchetypes=function(e,t){var r=n.defer();return Servant.queryArchetypes(e,t,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.deleteArchetype=function(e,t){var r=n.defer();return Servant.deleteArchetype(e,t,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.archetypesRecent=function(e,t){var r=n.defer();return Servant.archetypesRecent(e,t,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.archetypesOldest=function(e,t){var r=n.defer();return Servant.archetypesOldest(e,t,function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},this.servantpayCharge=function(e){var t=n.defer();return Servant.servantpayCharge(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},this.servantpaySubscriptionCreate=function(e){var t=n.defer();return Servant.servantpaySubscriptionCreate(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},this.servantpaySubscriptionUpdate=function(e){var t=n.defer();return Servant.servantpaySubscriptionUpdate(e,function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},this.servantpaySubscriptionCancel=function(){var e=n.defer();return Servant.servantpaySubscriptionCancel(function(n){e.resolve(n)},function(n){e.reject(n)}),e.promise},this.servantpayCustomerDelete=function(){var e=n.defer();return Servant.servantpayCustomerDelete(function(n){e.resolve(n)},function(n){e.reject(n)}),e.promise}}]);